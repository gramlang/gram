FROM debian:stretch
COPY . /root/gram
RUN cd /root && \

  # Update package lists.
  DEBIAN_FRONTEND=noninteractive apt-get -y update && \

  # Install various packages.
  DEBIAN_FRONTEND=noninteractive apt-get -y install \
    # For `make`
    build-essential \

    # For building LLVM and Gram
    clang \

    # For building LLVM
    cmake \

    # For embedding the commit hash in the metadata reported by `gram -v`
    git \

    # For building LLVM (optional, but speeds up the build)
    ninja-build \

    # For installing the AWS CLI (installed below)
    python-pip \

    # For installing the `github-pages` gem (installed below)
    ruby \

    # For installing the `github-pages` gem (installed below)
    ruby-dev \

    # Used by `make lint`
    shellcheck \

    # Used by `make spec`
    texlive-full \

    # For installing the `github-pages` gem (installed below)
    zlib1g-dev && \

  # Now that the packages are installed, free up some space by removing the
  # package lists.
  rm -rf /var/lib/apt/lists/* && \

  # Install the `github-pages` gem (for `make docs`).
  gem install github-pages && \

  # Install the AWS CLI (for `make spec`).
  pip install awscli && \

  # Build LLVM for Gram.
  cd gram && \
  make build/release/llvm && \
  cd .. && \
  mv gram/build build && \
  rm -rf gram
